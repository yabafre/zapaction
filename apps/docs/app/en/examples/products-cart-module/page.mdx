# Multi-feature Module

When your app grows, organize actions by feature using `createFeatureKeys` and `createFeatureTags`.

## Structure

```txt filename="features"
features/
  todos/
    actions.ts
    keys.ts
    hooks.ts
  projects/
    actions.ts
    keys.ts
    hooks.ts
```

## Feature keys and tags

```ts filename="features/todos/keys.ts"
// features/todos/keys.ts
import { createFeatureKeys, createFeatureTags } from "@zapaction/core";

export const todoKeys = createFeatureKeys("todos", {
  list: () => [],
  detail: (id: string) => [id],
});

export const todoTags = createFeatureTags("todos", {
  list: () => [],
  detail: (id: string) => [id],
});

// todoKeys.list()   → ["todos", "list"]
// todoTags.list()   → ["todos", "list"]
// todoKeys.detail("42") → ["todos", "detail", "42"]
```

## Actions

```ts filename="features/todos/actions.ts"
// features/todos/actions.ts
export const listTodos = defineAction({
  name: "listTodos",
  input: z.object({}),
  output: z.array(todoSchema),
  handler: async () => db.todo.findMany(),
});

export const createTodo = defineAction({
  name: "createTodo",
  input: z.object({ title: z.string().min(1) }),
  output: todoSchema,
  tags: ["todos"],
  handler: async ({ input }) =>
    db.todo.create({ data: { ...input, done: false } }),
});
```

## Tag registry (client)

```ts filename="app/providers.tsx"
setTagRegistry({
  todos: [todoKeys.list()],
  projects: [projectKeys.list()],
});
```

## Cross-feature invalidation

When a todo belongs to a project, invalidate both features:

```ts filename="features/todos/actions.ts"
export const createTodo = defineAction({
  name: "createTodo",
  input: z.object({
    title: z.string().min(1),
    projectId: z.string(),
  }),
  output: todoSchema,
  tags: ["todos", "projects"],
  handler: async ({ input }) =>
    db.todo.create({ data: input }),
});
```

Both `todos` and `projects` queries will be invalidated when this action succeeds.
