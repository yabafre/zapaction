# Architecture

Use a feature-first layout from the start.

```txt
src/
  features/
    users/
      _actions/
      _queries/
      _hooks/
      _components/
```

## Layering rules

- Components do not call server actions directly
- Feature hooks call ZapAction hooks (`useActionQuery`, `useActionMutation`, `useAction`)
- Actions stay server-only

## Flow

```txt
RSC Page -> Client Component -> Feature Hook -> ZapAction Hook -> Server Action
```

## Keys and tags stay in the feature

```ts
export const usersKeys = createFeatureKeys("users", {
  list: () => [],
  detail: (id: string) => [id],
});

export const usersTags = createFeatureTags("users", {
  list: () => [],
  detail: (id: string) => [id],
});
```

This keeps ownership local and prevents route-level sprawl.
