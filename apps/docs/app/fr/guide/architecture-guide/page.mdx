# Architecture

Utilisez une structure feature-first dès le début.

```txt
src/
  features/
    users/
      _actions/
      _queries/
      _hooks/
      _components/
```

## Règles de layering

- Les composants n'appellent pas directement les server actions
- Les hooks feature appellent les hooks ZapAction (`useActionQuery`, `useActionMutation`, `useAction`)
- Les actions restent server-only

## Flux

```txt
RSC Page -> Client Component -> Feature Hook -> ZapAction Hook -> Server Action
```

## Keys et tags dans la feature

```ts
export const usersKeys = createFeatureKeys("users", {
  list: () => [],
  detail: (id: string) => [id],
});

export const usersTags = createFeatureTags("users", {
  list: () => [],
  detail: (id: string) => [id],
});
```

Ce pattern garde l'ownership local et évite le chaos au niveau des routes.
