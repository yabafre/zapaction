# React Query

Pour les lectures cote client, combine `@zapaction/query` avec `@tanstack/react-query` pour synchroniser les Server Actions et le cache de query.

<Callout type="warning">
  Les Server Actions sont excellentes pour les mutations. Pour des lectures tres frequentes, utilise des route handlers ou APIs quand c'est necessaire.
</Callout>

<Callout>
  Cette page suit un modele unique: une strategie de query keys, une strategie d'invalidation, et des etats visibles dans l'UI.
</Callout>

## Installation

Commence par installer les deux packages:

```bash filename="terminal"
pnpm add @zapaction/query @tanstack/react-query
```

Cree un provider et initialise le registre une seule fois:

```tsx filename="app/providers.tsx"
"use client";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { setTagRegistry } from "@zapaction/query";
import { useState } from "react";

import { appKeys } from "./query-keys";

setTagRegistry({
  todos: [appKeys.todos()],
});

export function AppProviders({ children }: { children: React.ReactNode }) {
  const [client] = useState(() => new QueryClient());
  return <QueryClientProvider client={client}>{children}</QueryClientProvider>;
}
```

## Usage

Dans un composant client:

1. Importe ta server action et ta query key.
2. Utilise `useActionQuery` avec `readPolicy: "read-only"`.
3. Utilise `useActionMutation` pour les ecritures afin d'invalider via les tags.
4. Rends les etats `loading`, `success`, `error` de facon explicite.

```tsx filename="components/todo-panel.tsx"
"use client";

import { useActionMutation, useActionQuery } from "@zapaction/query";

import { createTodo, listTodos } from "../app/actions";
import { appKeys } from "../app/query-keys";

const { data: todos, isPending, isError } = useActionQuery(listTodos, {
  input: {},
  queryKey: appKeys.todos(),
  readPolicy: "read-only",
});

const createMutation = useActionMutation(createTodo);
```

Apercu du resultat:

<LiveHelloCard locale="fr" />

Comme montre ci-dessus, les transitions d'etat restent explicites et testables.
