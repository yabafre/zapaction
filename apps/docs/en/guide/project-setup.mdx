---
title: "Project Setup"
description: "Install and bootstrap ZapAction in a Next.js App Router project."
---

# Project Setup

## Prerequisites

- Next.js App Router project.
- Node.js 20+.
- A package manager (`pnpm`, `npm`, or `yarn`).

## Install packages

```bash terminal
pnpm add @zapaction/core @zapaction/react @zapaction/query @tanstack/react-query zod
```

```bash terminal
npm install @zapaction/core @zapaction/react @zapaction/query @tanstack/react-query zod
```

## Configure server context

```ts app/bootstrap.server.ts
import { setActionContext } from "@zapaction/core";

setActionContext(async () => {
  const userId = "demo-user";
  return { userId, roles: ["user"] };
});
```

## Define one server action

```ts app/actions.ts
"use server";

import { defineAction } from "@zapaction/core";
import { z } from "zod";

export const createTodo = defineAction({
  name: "createTodo",
  input: z.object({ title: z.string().min(1) }),
  output: z.object({
    id: z.string(),
    title: z.string(),
    done: z.boolean()
  }),
  tags: ["todos"],
  handler: async ({ input, ctx }) => ({
    id: crypto.randomUUID(),
    title: `[${ctx.userId}] ${input.title}`,
    done: false
  })
});
```

## Configure Query client and tag registry

```tsx app/providers.tsx
"use client";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { setTagRegistry } from "@zapaction/query";
import { useState } from "react";

setTagRegistry({
  todos: [["todos"]]
});

export function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient());
  return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
}
```

## Wire providers in layout

```tsx app/layout.tsx
import { Providers } from "./providers";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

## Verify setup

```bash terminal
pnpm test
pnpm --filter @zapaction/example-next-app dev
```
